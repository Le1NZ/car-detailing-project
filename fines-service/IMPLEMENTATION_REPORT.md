# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Fines Service

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ

- **–ò–º—è —Å–µ—Ä–≤–∏—Å–∞**: fines-service
- **–ü–æ—Ä—Ç**: 8007
- **–ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å**: `/Users/fr4lzen/Documents/–º–∏—Ä—ç–∞/–º–∏–∫—Ä–æ—Å—ã/–ø—Ä7/project/fines-service`
- **–í–µ—Ä—Å–∏—è**: 1.0.0
- **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞**: ‚Ññ6

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
fines-service/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ config.py                            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fine.py                          # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ local_fine_repo.py               # In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fine_service.py                  # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ endpoints/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ fines.py                         # API endpoints
‚îú‚îÄ‚îÄ requirements.txt                          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile                                # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ .dockerignore
‚îî‚îÄ‚îÄ README.md
```

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (app/models/fine.py)

#### Fine (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º–æ–¥–µ–ª—å)
- `fine_id: UUID` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `license_plate: str` - –Ω–æ–º–µ—Ä –¢–°
- `amount: float` - —Å—É–º–º–∞ —à—Ç—Ä–∞—Ñ–∞
- `description: str` - –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
- `date: date` - –¥–∞—Ç–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è
- `paid: bool` - —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é False)

#### FineResponse (API –æ—Ç–≤–µ—Ç)
- `fine_id: UUID`
- `amount: float`
- `description: str`
- `date: date`

#### PayFineRequest (–∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–ø–ª–∞—Ç—É)
- `payment_method_id: str` - ID –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã

#### PaymentResponse (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã)
- `payment_id: UUID` - ID –ø–ª–∞—Ç–µ–∂–∞
- `fine_id: UUID` - ID —à—Ç—Ä–∞—Ñ–∞
- `status: str` - —Å—Ç–∞—Ç—É—Å ("paid")

### 2. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (app/repositories/local_fine_repo.py)

**LocalFineRepository** - in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
- `_fines: Dict[str, List[Fine]]` - –∏–Ω–¥–µ–∫—Å –ø–æ –Ω–æ–º–µ—Ä—É –¢–°
- `_fines_by_id: Dict[UUID, Fine]` - –∏–Ω–¥–µ–∫—Å –ø–æ ID —à—Ç—Ä–∞—Ñ–∞

**–ú–µ—Ç–æ–¥—ã:**
- `get_fines_by_plate(license_plate)` - –≤—Å–µ —à—Ç—Ä–∞—Ñ—ã –ø–æ –Ω–æ–º–µ—Ä—É
- `get_unpaid_fines_by_plate(license_plate)` - –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã
- `get_fine_by_id(fine_id)` - —à—Ç—Ä–∞—Ñ –ø–æ ID
- `mark_fine_as_paid(fine_id)` - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π
- `is_fine_paid(fine_id)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
1. –ê123–ë–í799: 500 —Ä—É–±. - "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ 20-40 –∫–º/—á" (2024-05-15)
2. –ú456–ö–õ177: 1000 —Ä—É–±. - "–ü—Ä–æ–µ–∑–¥ –Ω–∞ –∫—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ç" (2024-06-01)

### 3. –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π (app/services/fine_service.py)

**FineService** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:

#### check_fines(license_plate: str) -> List[FineResponse]
- –ü–æ–ª—É—á–∞–µ—Ç –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã –¥–ª—è –Ω–æ–º–µ—Ä–∞ –¢–°
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫, –µ—Å–ª–∏ —à—Ç—Ä–∞—Ñ–æ–≤ –Ω–µ—Ç
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ API –æ—Ç–≤–µ—Ç—ã

#### pay_fine(fine_id: UUID, payment_method_id: str) -> PaymentResponse
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —à—Ç—Ä–∞—Ñ–∞ (ValueError –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã (RuntimeError –µ—Å–ª–∏ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω)
- –û—Ç–º–µ—á–∞–µ—Ç —à—Ç—Ä–∞—Ñ –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç UUID –¥–ª—è –ø–ª–∞—Ç–µ–∂–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "paid"

### 4. API Endpoints (app/endpoints/fines.py)

#### GET /api/fines/check
**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `license_plate` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –Ω–æ–º–µ—Ä —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞

**–û—Ç–≤–µ—Ç:** 200 OK
```json
[
  {
    "fine_id": "uuid",
    "amount": 500.0,
    "description": "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ 20-40 –∫–º/—á",
    "date": "2024-05-15"
  }
]
```

#### POST /api/fines/{fine_id}/pay
**Path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `fine_id` (UUID) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —à—Ç—Ä–∞—Ñ–∞

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "payment_method_id": "card_123"
}
```

**–û—Ç–≤–µ—Ç—ã:**
- **200 OK** - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
```json
{
  "payment_id": "uuid",
  "fine_id": "uuid",
  "status": "paid"
}
```
- **404 Not Found** - —à—Ç—Ä–∞—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω
- **409 Conflict** - —à—Ç—Ä–∞—Ñ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω

### 5. –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (app/main.py)

**FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å:
- –†–æ—É—Ç–µ—Ä `/api/fines/*` (fines endpoints)
- Health check endpoint: `GET /health`
- Root endpoint: `GET /` (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `/docs` –∏ `/redoc`

### 6. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (app/config.py)

**Settings** (Pydantic BaseSettings):
- `service_name: str = "fines-service"`
- `service_port: int = 8007`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `.env` —Ñ–∞–π–ª–æ–≤

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt)

```
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0
pydantic-settings==2.1.0
```

## Docker –æ–±—Ä–∞–∑ (Dockerfile)

- **–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**: python:3.11-slim
- **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**: /app
- **–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞**: uvicorn app.main:app --host 0.0.0.0 --port 8007
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å `--no-cache-dir` –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –¢—Ä–µ—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
1. **Endpoints** - HTTP endpoints, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
2. **Services** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
3. **Repositories** - —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (in-memory)

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- Type hints –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —á–µ—Ä–µ–∑ Pydantic –º–æ–¥–µ–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- 404 Not Found - —à—Ç—Ä–∞—Ñ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- 409 Conflict - –ø–æ–ø—ã—Ç–∫–∞ –æ–ø–ª–∞—Ç–∏—Ç—å —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π —à—Ç—Ä–∞—Ñ
- 422 Unprocessable Entity - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç FastAPI)

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
cd /Users/fr4lzen/Documents/–º–∏—Ä—ç–∞/–º–∏–∫—Ä–æ—Å—ã/–ø—Ä7/project/fines-service
pip install -r requirements.txt
uvicorn app.main:app --host 0.0.0.0 --port 8007 --reload
```

### Docker
```bash
cd /Users/fr4lzen/Documents/–º–∏—Ä—ç–∞/–º–∏–∫—Ä–æ—Å—ã/–ø—Ä7/project/fines-service
docker build -t fines-service .
docker run -p 8007:8007 fines-service
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```bash
# Health check
curl http://localhost:8007/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —à—Ç—Ä–∞—Ñ–æ–≤
curl "http://localhost:8007/api/fines/check?license_plate=–ê123–ë–í799"

# –û–ø–ª–∞—Ç–∞ —à—Ç—Ä–∞—Ñ–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ fine_id –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞)
curl -X POST "http://localhost:8007/api/fines/{fine_id}/pay" \
  -H "Content-Type: application/json" \
  -d '{"payment_method_id": "card_123"}'
```

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

‚úÖ **API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**
- GET /api/fines/check - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- POST /api/fines/{fine_id}/pay - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

‚úÖ **–¢—Ä–µ—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- Endpoints (fines.py)
- Services (fine_service.py)
- Repositories (local_fine_repo.py)

‚úÖ **In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**
- Dict[str, List[Fine]] –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞ –ø–æ –Ω–æ–º–µ—Ä—É
- Dict[UUID, Fine] –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞ –ø–æ ID

‚úÖ **Pydantic –º–æ–¥–µ–ª–∏**
- Fine, FineResponse, PayFineRequest, PaymentResponse

‚úÖ **–ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**
- 2 —à—Ç—Ä–∞—Ñ–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP –∫–æ–¥—ã**
- 200 OK - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- 404 Not Found - —à—Ç—Ä–∞—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω
- 409 Conflict - —à—Ç—Ä–∞—Ñ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω

‚úÖ **Dockerfile**
- Python 3.11-slim –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8007

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- Health check endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- Root endpoint —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–µ—Ä–≤–∏—Å–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger UI –∏ ReDoc
- Type hints –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö
- Docstrings –¥–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
- README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- .dockerignore –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

üü¢ **–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –†–∞–±–æ—Ç—ã ‚Ññ6 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ.
